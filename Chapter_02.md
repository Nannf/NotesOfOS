# 第二章 操作系统结束

### 内容提要





Q: 程序运行的时候发生了什么？

A: 简单的说程序的运行就做了一件事情，就是执行指令，具体而言，可分为以下几个步骤：

1. 指令的获取（Fetch），至于处理器是怎么知道到哪个位置去获取指令我们暂时不管，反正就是拿到了
2. 指令的解码（Decode），我们获取到的指令都是二进制的01序列，每个处理器都有一个指令集架构（ISA），可以理解为一个哈希表，哈希表的键是01序列，哈希表的值是对应的指令含义（比如两数相加，访问内存，检查条件，跳转到函数等）
3. 指令的执行（Execute），把刚刚解码的结果执行。



Q: 我们为什么需要操作系统

A：首先我们需要明确，操作系统是一类软件，这类软件是让硬件可以被容易，高效，正确的使用。

-  具体的来说，就是如果我们没有操作系统，我们编写的程序就会直面硬件，面向的是cpu的指令集，面向的是01序列编码，操作系统把如何操作硬件的功能封装起来，作为一个系统调用，方便程序的开发和运行，从这个意义上来说，操作系统是一个**系统库**
- 如果我们需要在这机器上运行多个程序，那多个程序之间的执行次序是什么样子的？谁来判断谁先执行，程序都会访问这些硬件，比如都会操作磁盘，都在写，我怎么判断我写的数据不会被别人的程序覆盖呢？这就是操作系统的另一个作用，就是整合硬件资源，协调给多个程序之间使用，从这个意义上来说，操作系统是一个**资源管理器**



> 就资源管理器这个特性而言，其中最重要的就是**虚拟化**，其实在系统库的特性的时候，我们就发现，操作系统对硬件资源进行了一次封装，这个封装就是一次虚拟化，下面就从虚拟化CPU和内存来谈谈这个虚拟化

Q: 虚拟化CPU指的是什么

A：直观的表现就是，我的电脑可以同时运行很多个程序，这是远远大于处理器的数量的，操作系统给用户程序的感觉就是每个程序都有一个单独的处理器在为他服务。



Q：虚拟化内存是什么

A： 现代机器的物理内存其实就是一个字节数组。无论是读取，写入，更新都需要一个地址，这里可以理解为字节数组的下标索引。



Q: 虚拟化内存存在的意义

A:  我觉得虚拟化内存是虚拟化CPU的必然后果，因为如果容许同时有多个程序在运行，为了保证多个程序在运行的过程中不会出现因为使用同块内存而导致的各种不可预知的错误，需要给每个程序一个独立的从零开始的连续的内存。





> 当虚拟化CPU出现的时候，附带的引出了另一个问题就是并发，逻辑是这样的，cpu调度的最小单元是线程，一个进程可能包含多个线程，跟上面虚拟化内存，不同进程之间的内存互相隔离的情况不同的是，一个进程的多个线程之间的内存是共享的，当多个线程操作可被多个线程共享的内存的时候，就会出现各种不可预测的问题。这就需要操作系统提供一系列的机制来保障这种并发的情况。



